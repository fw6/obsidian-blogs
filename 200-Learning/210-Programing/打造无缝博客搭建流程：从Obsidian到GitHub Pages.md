---
title: "æ‰“é€ æ— ç¼åšå®¢æ­å»ºæµç¨‹ï¼šä»Obsidianåˆ°GitHub Pages"
description: "æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨Obsidianåˆ›ä½œåšå®¢ï¼Œåœ¨GitHubè‡ªåŠ¨åŒæ­¥ï¼Œé€šè¿‡GitHub Workflowå®ç°åˆ†æ”¯åˆå¹¶ï¼Œç»“åˆAstroå‰ç«¯æ¡†æ¶æ­å»ºç½‘ç«™ï¼Œè‡ªåŠ¨éƒ¨ç½²è‡³GitHub Pagesã€‚é€šè¿‡è¿™æ— ç¼æµç¨‹ï¼Œåˆ›ä½œè€…å¯ä»¥ä¸“æ³¨äºå†…å®¹ï¼Œæ— éœ€ç¹çæ“ä½œï¼Œæ‰“é€ ä¸ªäººåšå®¢ã€‚"
pubDate: "2023-08-12 22:43"
heroImage: "https://images.unsplash.com/photo-1504805572947-34fad45aed93?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1200&q=80"
date created: "2023-08-12 22:43"
date modified: "2023-08-12"
tags:
    - writings
---

# æ‰“é€ æ— ç¼åšå®¢æ­å»ºæµç¨‹ï¼šä»Obsidianåˆ°GitHub Pages

> True knowledge exists in knowing that you know nothing.
> â€” <cite>Isocrates</cite>

:::tip
ä»¥ä¸‹å†…å®¹é€šè¿‡[ChatGPTç”Ÿæˆ](https://chat.openai.com/share/86232a67-ea2d-4975-8989-a620d6c11b26)+å¾®è°ƒï¼ˆæ‡’å¾—å†™äº†ğŸ˜„ï¼‰
:::

[åšå®¢æ–‡ç« ä»“åº“](https://github.com/fw6/obsidian-blogs)
[åšå®¢ç«™ç‚¹ä»“åº“](https://github.com/fw6/blog)

éšç€æ•°å­—æ—¶ä»£çš„åˆ°æ¥ï¼Œä¸ªäººåšå®¢æˆä¸ºå±•ç¤ºè‡ªæˆ‘ã€åˆ†äº«çŸ¥è¯†çš„ç†æƒ³å¹³å°ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†ä»‹ç»æˆ‘æ˜¯å¦‚ä½•æ­å»ºæˆ‘çš„ä¸ªäººåšå®¢ç½‘ç«™ï¼Œé€šè¿‡å°†Obsidianã€GitHubä»¥åŠAstroå‰ç«¯æ¡†æ¶ç­‰å·¥å…·æœ‰æœºç»“åˆï¼Œå®ç°äº†åšå®¢æ–‡ç« çš„åˆ›ä½œã€åŒæ­¥å’Œå±•ç¤ºçš„æ— ç¼æµç¨‹ã€‚

## ä½¿ç”¨Obsidianè¿›è¡Œåšå®¢åˆ›ä½œ

æˆ‘é€‰æ‹©ä½¿ç”¨Obsidianä½œä¸ºåšå®¢æ–‡ç« çš„åˆ›ä½œå·¥å…·ï¼Œå› ä¸ºå®ƒæä¾›äº†ä¼˜é›…çš„ç¬”è®°ç®¡ç†å’Œç¼–è¾‘ä½“éªŒã€‚åœ¨Obsidianä¸­ï¼Œæˆ‘å¯ä»¥è½»æ¾åœ°ç»„ç»‡æˆ‘çš„æ€ç»´ï¼Œç¼–å†™æ–‡ç« ï¼Œå¹¶æ·»åŠ æ ‡ç­¾ã€é“¾æ¥ç­‰å…ƒç´ ã€‚è¿™ä½¿å¾—åšå®¢å†…å®¹çš„åˆ›ä½œå˜å¾—é«˜æ•ˆè€Œæœ‰è¶£ã€‚

## å®ç°åšå®¢å†…å®¹è‡ªåŠ¨åŒæ­¥

ä¸ºäº†å°†æˆ‘åœ¨Obsidianä¸­åˆ›ä½œçš„å†…å®¹è‡ªåŠ¨åŒæ­¥åˆ°æˆ‘çš„GitHubä»“åº“ä¸­ï¼Œæˆ‘ä½¿ç”¨äº†`obsidian-git`æ’ä»¶ã€‚é€šè¿‡é…ç½®è¿™ä¸ªæ’ä»¶ï¼Œæ¯å½“æˆ‘åœ¨Obsidianä¸­ä¿å­˜ä¸€ç¯‡æ–‡ç« ï¼Œå®ƒä¼šè‡ªåŠ¨å°†æ–‡ç« åŒæ­¥åˆ°GitHubä»“åº“çš„`master`åˆ†æ”¯ä¸­ã€‚

## åˆ©ç”¨GitHub Workflowå®ç°è‡ªåŠ¨åˆ†æ”¯åˆå¹¶

åœ¨GitHubä»“åº“ä¸­ï¼Œæˆ‘è®¾ç½®äº†ä¸€ä¸ªGitHub Workflowï¼Œä»¥ä¾¿åœ¨æ¯æ¬¡å°†å†…å®¹æ¨é€åˆ°`master`åˆ†æ”¯æ—¶è‡ªåŠ¨è§¦å‘åˆ†æ”¯åˆå¹¶æ“ä½œã€‚å…·ä½“è€Œè¨€ï¼Œæˆ‘å°†`master`åˆ†æ”¯åˆå¹¶åˆ°ä¸€ä¸ªä¸“é—¨ç”¨äºåšå®¢å†…å®¹çš„`blog`åˆ†æ”¯ä¸­ã€‚è¿™æ ·ï¼Œæˆ‘å¯ä»¥ç¡®ä¿åšå®¢æ–‡ç« çš„å†…å®¹å§‹ç»ˆä¿æŒåŒæ­¥ï¼Œä¸”èƒ½å¤Ÿè½»æ¾åœ°è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ã€‚

å¦‚æœè‡ªåŠ¨åŒæ­¥å¤±è´¥â˜¹ï¸ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºPRï¼ˆå°†`master`åˆå¹¶åˆ°`blog`åˆ†æ”¯ï¼‰ğŸ“¢

```yaml
name: CI_auto_merge
on:
  push:
    branches:
      - master
    paths:
      - '**.md'
      - '**.mdx'

jobs:
  auto-merge-blog-branch:
    name: Auto merge blog branch
    runs-on: ubuntu-latest
    permissions: write-all
    steps:
      - name: checkout
        uses: actions/checkout@v3
        with:
          ref: blog

      - name: Set Git config
        run: |
            git config --local user.email "actions@github.com"
            git config --local user.name "Github Actions"

      - name: Merge master back to blog
        run: |
            git fetch --unshallow
            git pull
            git merge --no-ff origin/master -m "Auto-merge master back to blog"
            git push

      - name: Generate a pr after after previous step failed
        if: ${{ failure() }}
        run: |
            gh pr create --base astro --head master --title "Auto Merge Astro Branch" --body "Auto Merge Astro Branch" --label "automerge"
        env:
            GH_TOKEN: ${{ github.token }}

      - name: Trigger Astro CI workflow on master branch at blog repo from outside
        # https://stackoverflow.com/questions/71499150/how-to-run-a-workflow-using-github-cli
        run: gh workflow run astro.yml --ref master --repo git@github.com:fw6/blog.git
        env:
            GH_TOKEN: ${{ secrets.workflow_triggers }}
        # run: |
        #     REPO_OWNER=fw6
        #     REPO_NAME=blog
        #     BRANCH=master
        #     WORKFLOW_ID=astro.yml
        #     ACCESS_TOKEN=${{ secrets.workflow_triggers }}
        #     URL="https://api.github.com/repos/$REPO_OWNER/$REPO_NAME/actions/workflows/$WORKFLOW_ID/dispatches"
        #     PAYLOAD='{"ref":"$BRANCH"}'

        #     curl -X POST -H "Accept: application/vnd.github.v3+json" \
        #         -H "Authorization: Bearer $ACCESS_TOKEN" \
        #         -H "Content-Type: application/json" \
        #         -d "$PAYLOAD" \
        #         "$URL"
```

## åŸºäºAstroå‰ç«¯æ¡†æ¶æ­å»ºåšå®¢ç½‘ç«™

ä¸ºäº†å°†åšå®¢å†…å®¹å‘ˆç°ç»™è¯»è€…ï¼Œæˆ‘é€‰æ‹©äº†Astroå‰ç«¯æ¡†æ¶æ­å»ºåšå®¢ç½‘ç«™ã€‚æˆ‘åˆ›å»ºäº†ä¸€ä¸ªç‹¬ç«‹çš„ä»£ç ä»“åº“ï¼Œå¹¶ä½¿ç”¨Gitçš„`submodule`åŠŸèƒ½å°†å…¶ä¸åšå®¢æ–‡ç« çš„`blog`åˆ†æ”¯å…³è”èµ·æ¥ã€‚è¿™æ ·ï¼Œæˆ‘å¯ä»¥åœ¨ç½‘ç«™ä¸­å±•ç¤ºæœ€æ–°çš„åšå®¢å†…å®¹ï¼Œä¸Obsidianä¸­çš„æ–‡ç« ä¿æŒåŒæ­¥ã€‚

## æ„å»ºGitHub Workflowå®ç°è‡ªåŠ¨éƒ¨ç½²

åœ¨åšå®¢ç½‘ç«™çš„æºç ä»“åº“ä¸­ï¼Œæˆ‘è®¾ç½®äº†å¦ä¸€ä¸ªGitHub Workflowï¼Œä»¥å®ç°è‡ªåŠ¨éƒ¨ç½²ã€‚è¿™ä¸ªWorkflowåŒ…æ‹¬ä»¥ä¸‹ä¸»è¦æ­¥éª¤ï¼š

1. åŒæ­¥`submodule`ï¼šé¦–å…ˆï¼ŒWorkflowä¼šåŒæ­¥åšå®¢æ–‡ç« æ‰€åœ¨ä»“åº“çš„`blog`åˆ†æ”¯ï¼Œç¡®ä¿ç½‘ç«™æºç ä¸æœ€æ–°çš„åšå®¢å†…å®¹ä¸€è‡´ã€‚
2. å®‰è£…Node.jså’Œä¾èµ–é¡¹ï¼šæ¥ä¸‹æ¥ï¼ŒWorkflowä¼šå®‰è£…æ‰€éœ€çš„Node.jså’Œä¾èµ–é¡¹ï¼Œä»¥å‡†å¤‡è¿›è¡Œç½‘ç«™çš„ç¼–è¯‘å’Œæ„å»ºã€‚
3. è§¦å‘Astroç¼–è¯‘è„šæœ¬ï¼šWorkflowä¼šæ‰§è¡ŒAstroç¼–è¯‘è„šæœ¬ï¼Œå°†åšå®¢ç½‘ç«™çš„æºç è½¬æ¢ä¸ºé™æ€æ–‡ä»¶ï¼Œå‡†å¤‡éƒ¨ç½²åˆ°GitHub Pagesä¸Šã€‚
4. éƒ¨ç½²åˆ°GitHub Pagesï¼šæœ€åï¼ŒWorkflowå°†ç¼–è¯‘åçš„é™æ€æ–‡ä»¶éƒ¨ç½²åˆ°GitHub Pagesä¸Šï¼Œä½¿å¾—æˆ‘çš„åšå®¢å†…å®¹èƒ½å¤Ÿåœ¨äº’è”ç½‘ä¸Šè®¿é—®ã€‚

```yaml
# Sample workflow for building and deploying an Astro site to GitHub Pages
#
# To get started with Astro see: https://docs.astro.build/en/getting-started/
#
name: Deploy Astro site to Pages

on:
  # Runs on pushes targeting the default branch
  push:
    branches: ["master"]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# Sets permissions of the GITHUB_TOKEN to allow deployment to GitHub Pages
permissions:
  contents: read
  pages: write
  id-token: write

# Allow only one concurrent deployment, skipping runs queued between the run in-progress and latest queued.
# However, do NOT cancel in-progress runs as we want to allow these production deployments to complete.
concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  build:
    name: Build
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        with:
          submodules: true

      # https://github.com/actions/checkout/issues/417#issuecomment-1640448307
      - name: Update submodules from origin master
        env:
            PAT: ${{ secrets.PAT }}
        run: |
            git submodule foreach --recursive git checkout master
            git submodule foreach --recursive git pull origin master

      - name: Remove obsidion directories
        run:
            rm -rf src/content/blog/{_github,_obsidian,_cedict_ts.u8,.obsidian,.github,.gitignore,renovate.json,cedict_ts.u8}

      - name: Setup pnpm
        # You may pin to the exact commit or the version.
        # uses: pnpm/action-setup@c3b53f6a16e57305370b4ae5a540c2077a1d50dd
        uses: pnpm/action-setup@v2.2.4
        with:
            run_install: false
            version: 8

      - name: Setup Node
        uses: actions/setup-node@v3
        with:
          node-version-file: "package.json"
          cache: "pnpm"

      - name: Get pnpm store directory
        id: pnpm-cache
        shell: bash
        run: |
            echo "STORE_PATH=$(pnpm store path)" >> $GITHUB_OUTPUT

      - uses: actions/cache@v3
        name: Setup pnpm cache
        with:
            path: ${{ steps.pnpm-cache.outputs.STORE_PATH }}
            key: ${{ runner.os }}-pnpm-store-${{ hashFiles('**/pnpm-lock.yaml') }}
            restore-keys: |
                ${{ runner.os }}-pnpm-store-

      - name: Install dependencies
        run: pnpm i

      - name: Setup Pages
        id: pages
        uses: actions/configure-pages@v3

      - name: Build with Astro
        run: |
          pnpm build \
            --site "${{ steps.pages.outputs.origin }}" \
            --base "${{ steps.pages.outputs.base_path }}"


      - name: Upload artifact
        uses: actions/upload-pages-artifact@v1
        with:
          path: "./dist"

  deploy:
    environment:
        name: github-pages
        url: ${{ steps.deployment.outputs.page_url }}
    needs: build
    runs-on: ubuntu-latest
    name: Deploy
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v2
```

é€šè¿‡è¿™ä¸ªç²¾å¿ƒè®¾è®¡çš„GitHub Workflowï¼Œæˆ‘å¯ä»¥å®ç°åšå®¢å†…å®¹çš„è‡ªåŠ¨æ›´æ–°å’Œéƒ¨ç½²ï¼Œè®©è¯»è€…éšæ—¶éšåœ°éƒ½èƒ½å¤Ÿæµè§ˆåˆ°æœ€æ–°çš„æ–‡ç« å’Œä¿¡æ¯ã€‚

## æ€»ç»“

é€šè¿‡å°†Obsidianã€GitHubå’ŒAstroå‰ç«¯æ¡†æ¶ç­‰å·¥å…·èåˆåœ¨ä¸€èµ·ï¼Œæˆ‘æˆåŠŸåœ°æ­å»ºäº†ä¸€ä¸ªé«˜æ•ˆã€è‡ªåŠ¨åŒ–çš„åšå®¢ç½‘ç«™æ­å»ºæµç¨‹ã€‚ä»åˆ›ä½œåˆ°åŒæ­¥å†åˆ°éƒ¨ç½²ï¼Œæ•´ä¸ªæµç¨‹æ— ç¼è¡”æ¥ï¼Œè®©æˆ‘èƒ½å¤Ÿä¸“æ³¨äºå†…å®¹åˆ›ä½œï¼Œè€Œä¸å¿…è¿‡å¤šæ‹…å¿ƒæŠ€æœ¯ç»†èŠ‚ã€‚å¸Œæœ›æœ¬æ–‡èƒ½å¤Ÿä¸ºæœ‰ç±»ä¼¼éœ€æ±‚çš„æœ‹å‹æä¾›ä¸€äº›æœ‰ç”¨çš„æ€è·¯å’Œæ–¹æ³•ã€‚
